<div id="two_col_col_one">
    <section id="event">
      <p><span class="label label-info">Conference Session</span> This event is part of the <%= link_to(@event.conference.name,conference_path(:id => @event.conference.hashtag)) %></p>
      <%- if @event.event_type == Event::BROADCAST -%>
        <p><span class="label label-success">Broadcast Session</span> This event is <%= link_to('available online',event_path(@event)) %></p>
      <%- end -%>

      <h2><%= @event.title -%></h2>

      <div id="session_id">
      <p><span class="badge badge-info">Session #<%= @event.id %></span></p>
      </div>
      <h3><%= display_room(@event.room) -%></h3>
      <div class="rating_wrapper">
        <% if current_learner %>
          <% if upvoted_object = current_learner.get_upvoted_object(@event.id, 'Event') %>
            <span id='undo_vote_event_<%= @event.id %>'><%= button_to '-', rating_path(upvoted_object), :method => :delete, :remote => true, :class => "btn" %></span>
          <% else %>
            <span id='upvote_event_<%= @event.id %>'><%= button_to '+', ratings_path(:rating => {:rateable_id => @event.id, :rateable_type => 'Event', :score => 1}), :method => :post, :remote => true, :class => "btn btn-primary" %></span>
          <% end %>
        <% else %>
          <%= render(partial: 'sign_in_to_vote')%>
          <%= button_to '+', {}, {:class => "btn signintovote sitv_element", :disabled => true} %>
          </div> <!-- end .sitv_element_wrapper  -->
        <% end %>
        <div id="event_votes" class="rating_detail">
          <%= render :partial => '/partials/ratings', locals: {rateable_object: @event} %>
        </div>
      </div>

      <% if @event.in_progress? %>
        <span class="happening_now"><em>Happening now</em></span>
        <br class="clearing"/>
      <% end %>

      <div class="description"><%= format_text_for_display(@event.description) -%></div>

      
      <% if @event.images.size > 0 %>

        <div class="images_wrapper clearfix"> 
        <% @event.images.each do |image| %>
          <% if image.persisted? %>
            <% if File.exists?(Rails.root.join("public#{image.file_url(:largethumb,false)}")) %>
            <div class="question_image_wrapper">
              <a data-toggle="modal" href="#myModal<%= image.id %>"><%= image_tag(image.file_url(:largethumb)) %></a>
            </div>

            <div id="myModal<%= image.id %>" class="modal hide" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
              <div class="modal-header">
                <p>
                  <strong><a href="#" type="button" data-dismiss="modal" aria-hidden="true">Close</a></strong> -
                  <%= link_to "View full size in a new window", image.file_url(), :target => "_blank" %>
                <p>
              </div>
              <div class="modal-body">
                <%= image_tag image.file_url() %>
              </div>
            </div>
            <% else %>
             <%= image_tag("missing_image.png", :size => "80x80", :class => 'missing_image size80x80') %>
            <% end %>
          <% end %>
        <% end %>  
        <br class="clearing" />
      </div>

    <% end %>


      <%- if @event.presenters.count > 0 -%>
        <h3>Presenters</h3>
        <p id="presenters"><%= display_presenters(@event.presenters) %></p>
      <%- end -%>



      <div class="tags">
        <h4 class="hide">Tags</h4>
        <p>
          <%-if @event.tags.length != 0 -%>
            <%= display_conference_tags(@event.tags) -%>
          <%-end -%>
        </p>
      </div>
      
      <div class="event_materials">
        <h3>Event Materials</h3>
        <div id="material-links-list">
          <%= render partial: 'material_links/material_links_list' %>
	      </div>

        <% if current_learner %>
          <p><%= link_to_function 'Add materials', '', :id => 'material-form-expansion', :class => 'btn' %></p>
          <div id="material-links-form" style="display: none;">
            <%= render partial: 'material_links/material_links_form' %>
	      </div>
	    <% end %>
      </div>
   </section>

   <div id="comment-section">
      <aside id="tweet_this">
        <%= render :partial => 'tweet_this'%>
      </aside>
      <h3>Session comments</h3>
      <%= render :partial => 'comments', :locals => {comments: @comments, event: @event} %>
   </div>

  <section id="event_meta">
    <p>Created by <%= link_to_learner(@event.creator) %></p>

    <%- if current_learner -%>
        <p><span class="edit"><%= link_to('edit this event', edit_conference_event_path(@event, :conference_id => @conference.id), :class => "editlink") -%></span></p>
    <%- end %>
  </section>

</div>



<div id="two_col_col_two">


  <aside id="event_time" class="radius10">
    <h3>
       <span id="session_date"><%= @event.session_start.strftime("%B %e, %Y") -%></span>
       <span class="calendarblock">
          <span class="month"><%= @event.session_start.strftime("%b") -%></span>
          <span class="date"><%= @event.session_start.strftime("%d") -%></span>
       </span>
       <span id="session_date_time">
          <span id="time"><%= @event.session_start.strftime("%l:%M %p").downcase -%> <span id="timezone"><%= @event.session_start.strftime("%Z") -%></span></span>
       </span>
    </h3>



    <h4 id="session_duration"><strong><%= "#{@event.session_length}" -%> minute</strong> session</h4>
    <p class="addtocalendar">
      <span id="event_date" class="addtocal">
        Add to calendar
        <span class="summary" style="display:none"><%= "Learn Event: #{@event.title}" %></span>
        <span class="dtstart" style="display:none"><%= add_to_cal_timestamp(@event.session_start) %></span>
        <span class="dtend" style="display:none"><%= add_to_cal_timestamp(@event.session_end) %></span>
        <span class="description" style="display:none"><%= event_url(@event) %></span>
        <span class="ics_url" style="display:none"><%= conference_event_url(@event, :conference_id => @event.conference.hashtag, :format => :ics) %></span>
        <span class="vcs_url" style="display:none"><%= conference_event_url(@event, :conference_id => @event.conference.hashtag, :format => :vcs) %></span>
      </span>
    </p>

    <p><%= link_to('Other Sessions at this same time', schedule_conference_path(id: @event.conference.hashtag, datetime: @event.session_start.xmlschema)) %></p>

    <%-if @event.started? -%>
      <%- if current_learner -%>
        <%- if current_learner.is_presenter_for_event?(@event) -%>
          <p><%= link_to('Evaluation results for this session', evaluationresults_event_path(@event)) %></p>
        <%- else -%>
          <p><%= link_to('Evaluate this session', evaluation_event_path(@event)) %></p>
        <%- end -%>
      <%- end -%>
    <%- end -%>
  </aside>

    <%- if current_learner -%>

      <aside id="eventconnections" class="radius10">
        <%= render :partial => 'connections' %>
      </aside>

      <%= render :partial => 'learners' %>
    <%- else -%>
       <aside id="eventconnections" class="radius10 placeholder">
         <%= render(partial: 'sign_in_to_vote')%>
          <%- if @event.started? -%>
            <p class="sitv_element cursor">Did you attend or watch this event or want to follow it?</p>
          <%- else -%>
            <p class="sitv_element cursor"><%= link_to("Follow this event", new_learner_session_path(:redirect_to => request.fullpath)) -%></p>
          <%- end -%>
          </div> <!-- end .sitv_element_wrapper  -->
          <br class="clearing" />
       </aside>
     <%- end -%>


<br class='clearing' />
</div>

<script class="code" type="text/javascript">
  $('#material-form-expansion').click(function(){
    $('#material-links-form').slideToggle('slow');
    if($('#material-form-expansion').text() == 'Cancel') {
	  $('#material-form-expansion').text('Add materials');
    }
    else {
	  $('#material-form-expansion').text('Cancel'); 
    }
  });
</script>